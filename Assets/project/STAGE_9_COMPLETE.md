# ‚úÖ –≠–¢–ê–ü 9: –ó–ê–í–ï–†–®–ï–ù - Drag & Drop —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ—Å–æ—Ö–∞

**–î–∞—Ç–∞**: 20 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Unity

---

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 1. WandSlotUI.cs
**–§–∞–π–ª**: `Scripts/UI/WandSlotUI.cs`  
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- Drag & Drop –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∏–∫–æ–Ω–∫–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–≤–µ—Ç)
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
- –†–µ–∞–ª–∏–∑—É–µ—Ç `IBeginDragHandler`, `IDragHandler`, `IEndDragHandler`, `IDropHandler`

### ‚úÖ 2. WandEditorUI.cs
**–§–∞–π–ª**: `Scripts/UI/WandEditorUI.cs`  
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ —Å–ª–æ—Ç–∞–º–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç swap –ø—Ä–∏ drag & drop
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è Wand

---

## üéÆ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Unity

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ—Ñ–∞–± WandSlot

1. **Hierarchy ‚Üí –ü–ö–ú ‚Üí UI ‚Üí Image** ‚Üí –Ω–∞–∑–æ–≤–∏—Ç–µ `WandSlot`
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ RectTransform**:
   - Width: `80`, Height: `80`
3. **Image (—Ñ–æ–Ω)**:
   - Color: –±–µ–ª—ã–π —Å Alpha 200
4. **–î–æ–±–∞–≤—å—Ç–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã**:

   **Icon** (–¥–æ—á–µ—Ä–Ω–∏–π):
   - –ü–ö–ú –Ω–∞ WandSlot ‚Üí UI ‚Üí Image ‚Üí –Ω–∞–∑–æ–≤–∏—Ç–µ `Icon`
   - Width: `64`, Height: `64`
   - Anchors: Center
   
   **Text** (–¥–æ—á–µ—Ä–Ω–∏–π):
   - –ü–ö–ú –Ω–∞ WandSlot ‚Üí UI ‚Üí Text - TextMeshPro ‚Üí –Ω–∞–∑–æ–≤–∏—Ç–µ `Text`
   - –í–Ω–∏–∑—É —Å–ª–æ—Ç–∞ (Y: -35)
   - Font Size: `10`
   - Alignment: Center
   
   **Highlight** (–¥–æ—á–µ—Ä–Ω–∏–π):
   - –ü–ö–ú –Ω–∞ WandSlot ‚Üí UI ‚Üí Image ‚Üí –Ω–∞–∑–æ–≤–∏—Ç–µ `Highlight`
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å —Å–ª–æ—Ç
   - Color: –∂—ë–ª—Ç—ã–π —Å Alpha 50
   - –û—Ç–∫–ª—é—á–∏—Ç–µ –æ–±—ä–µ–∫—Ç (–≥–∞–ª–æ—á–∫–∞ —Å–ª–µ–≤–∞ –æ—Ç –∏–º–µ–Ω–∏)

5. **–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ WandSlot**:
   - Add Component ‚Üí **Wand Slot UI**
   - Add Component ‚Üí **Canvas Group** (–¥–ª—è drag & drop)
   - Add Component ‚Üí **Layout Element** (–¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Layout Group)
     - Preferred Width: `80`
     - Preferred Height: `80`
   
6. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ WandSlotUI**:
   - Background: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Image (—Å–∞–º —Å–ª–æ—Ç)
   - Icon: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Icon
   - Name Text: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Text
   - Highlight: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Highlight
   - Spell Color: RGB(77, 153, 255) - —Å–∏–Ω–∏–π
   - Buff Color: RGB(255, 204, 51) - –∑–æ–ª–æ—Ç–æ–π

7. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ –ø—Ä–µ—Ñ–∞–±**:
   - –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ WandSlot –≤ `Assets/project/Prefabs/` ‚Üí `WandSlot.prefab`
   - –£–¥–∞–ª–∏—Ç–µ –∏–∑ Hierarchy

---

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å UI —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –ø–æ—Å–æ—Ö–∞

1. **HUD Canvas ‚Üí –ü–ö–ú ‚Üí UI ‚Üí Panel** ‚Üí –Ω–∞–∑–æ–≤–∏—Ç–µ `WandEditor`
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ** (–≤–Ω–∏–∑—É –ø–æ —Ü–µ–Ω—Ç—Ä—É):
   - Anchors: Bottom Center
   - Pivot: (0.5, 0)
   - Position: X=`0`, Y=`20`
   - Width: `600`, Height: `120`
   
3. **Image (—Ñ–æ–Ω –ø–∞–Ω–µ–ª–∏)**:
   - Color: —á—ë—Ä–Ω—ã–π —Å Alpha 150

4. **–î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ª–æ—Ç–æ–≤**:
   - –ü–ö–ú –Ω–∞ WandEditor ‚Üí Create Empty ‚Üí –Ω–∞–∑–æ–≤–∏—Ç–µ `SlotsContainer`
   - Add Component ‚Üí **Horizontal Layout Group**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
     - Spacing: `10`
     - Child Alignment: Middle Center
     - Child Force Expand: Width ‚úó, Height ‚úì
   - Add Component ‚Üí **Content Size Fitter**
     - Horizontal Fit: Preferred Size

5. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ RectTransform SlotsContainer**:
   - Anchors: Stretch (–∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—é –ø–∞–Ω–µ–ª—å)
   - Offsets: Left=`10`, Right=`10`, Top=`10`, Bottom=`10`

6. **–î–æ–±–∞–≤—å—Ç–µ WandEditorUI –Ω–∞ WandEditor**:
   - Add Component ‚Üí **Wand Editor UI**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ:
     - Wand: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ **Player** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥—ë—Ç Wand)
     - Slot Prefab: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ `WandSlot.prefab`
     - Slots Container: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ `SlotsContainer`
     - Auto Refresh: ‚úì

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### Layout Element –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!

–ü—Ä–µ—Ñ–∞–± `WandSlot` **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å:
- ‚úÖ **Canvas Group** - –¥–ª—è drag & drop
- ‚úÖ **Layout Element** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Horizontal Layout Group
  - Preferred Width: `80`
  - Preferred Height: `80`

–ë–µ–∑ Layout Element —Å–ª–æ—Ç—ã –±—É–¥—É—Ç "–ø—Ä—ã–≥–∞—Ç—å" –∏ –º–µ–Ω—è—Ç—å —Ä–∞–∑–º–µ—Ä –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏!

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç swap

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —Å–ª–æ—Ç
2. `OnBeginDrag` - –æ—Ç–∫–ª—é—á–∞–µ—Ç `ignoreLayout = true`
3. –°–ª–æ—Ç —Å–ª–µ–¥—É–µ—Ç –∑–∞ –º—ã—à—å—é (–Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
4. `OnDrop` - –≤—ã–∑—ã–≤–∞–µ—Ç `wand.SwapSlots()` –∏ –º–µ–Ω—è–µ—Ç `SiblingIndex`
5. `OnEndDrag` - –≤–∫–ª—é—á–∞–µ—Ç `ignoreLayout = false`
6. Layout Group –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–æ—Ç—ã
7. **RefreshUI() –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã!**

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ StarterWand**:
   - Base Spells: Fireball, MagicMissile, Ice Spike
   - Passive Buffs: DamageUp

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É** (Play Mode)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∏–∂–Ω—é—é –ø–∞–Ω–µ–ª—å**:
   - –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è 3 —Å–ª–æ—Ç–∞ **–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ**
   - –°–∏–Ω–∏–π —Ü–≤–µ—Ç = –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ
   - –ò–∫–æ–Ω–∫–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –≤–∏–¥–Ω—ã

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–ª–æ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –≤–Ω–∏–∑—É

---

### –¢–µ—Å—Ç 2: Drag & Drop

1. **–í Play Mode**:
   - **–ó–∞–∂–º–∏—Ç–µ –õ–ö–ú** –Ω–∞ –ª—é–±–æ–º —Å–ª–æ—Ç–µ
   - **–¢–∞—â–∏—Ç–µ** –∫—É—Ä—Å–æ—Ä - —Å–ª–æ—Ç **–ø–ª–∞–≤–Ω–æ** —Å–ª–µ–¥—É–µ—Ç –∑–∞ –º—ã—à—å—é (–±–µ–∑ –ª–∞–≥–æ–≤!)
   - –†–∞–∑–º–µ—Ä —Å–ª–æ—Ç–∞ **–ù–ï –º–µ–Ω—è–µ—Ç—Å—è** –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
   - **–î—Ä—É–≥–∏–µ —Å–ª–æ—Ç—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è** –∂—ë–ª—Ç—ã–º

2. **–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–ª–æ—Ç** –∏ –æ—Ç–ø—É—Å—Ç–∏—Ç–µ –õ–ö–ú

3. **–°–º–æ—Ç—Ä–∏—Ç–µ Console**:
   ```
   [WandEditorUI] Swapped slots: 0 ‚Üî 2
   Swap complete! Modifiers recalculated.
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫** - —Å–ª–æ—Ç—ã –ø–æ–º–µ–Ω—è–ª–∏—Å—å –º–µ—Å—Ç–∞–º–∏ ‚úÖ
5. **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚úÖ

---

### –¢–µ—Å—Ç 3: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

1. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
   - –í Play Mode —á–µ—Ä–µ–∑ –ü–ö–ú ‚Üí Debug: Add Test Buff
   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ StarterWand

2. **–ù–∞—á–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫**:
   ```
   [0] Fireball (DMG=25)
   [1] MagicMissile (DMG=10)
   ```

3. **Player ‚Üí Wand ‚Üí –ü–ö–ú ‚Üí Debug: Test Modifiers**:
   ```
   [0] SPELL: Fireball
     FINAL: DMG=45.0
   [1] SPELL: MagicMissile
     FINAL: DMG=18.0
   ```

4. **–ü–æ–º–µ–Ω—è–π—Ç–µ –º–µ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ drag & drop**
5. **–°–Ω–æ–≤–∞ Debug: Test Modifiers** - —Ü–∏—Ñ—Ä—ã —Ç–µ –∂–µ (–Ω–µ—Ç –±–∞—Ñ—Ñ–æ–≤ –≤ —Å–ª–æ—Ç–∞—Ö)

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –¢–µ—Å—Ç 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ñ—Ñ–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥)

–ß—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å rightCumulative —Å drag & drop:

1. **–í Play Mode ‚Üí Player ‚Üí Wand**:
   - –ü–ö–ú ‚Üí Debug: Add Test Spell (–¥–æ–±–∞–≤–∏—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ)
   - –ü–ö–ú ‚Üí Debug: Add Test Buff (–¥–æ–±–∞–≤–∏—Ç –±–∞—Ñ)
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –Ω—É–∂–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

2. **–°–æ–∑–¥–∞–π—Ç–µ**:
   ```
   [0] Fireball
   [1] DamageUp
   ```

3. **Debug: Test Modifiers**:
   ```
   [0] SPELL: Fireball
     Affected by buffs: [1] Damage Up
     FINAL: DMG=67.5 (25 √ó 1.5 √ó 1.5 √ó 1.2)
   ```

4. **–ü–æ–º–µ–Ω—è–π—Ç–µ –º–µ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ drag & drop**:
   ```
   [0] DamageUp
   [1] Fireball
   ```

5. **Debug: Test Modifiers**:
   ```
   [1] SPELL: Fireball
     No buffs affecting this spell
     FINAL: DMG=45.0 (25 √ó 1.5 √ó 1.2)
   ```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ—Ä—è–¥–æ–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã!

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è

- [x] –°–ª–æ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ ‚úÖ
- [x] –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å —Å–ª–æ—Ç –º—ã—à—å—é ‚úÖ
- [x] –°–ª–æ—Ç—ã –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ ‚úÖ
- [x] –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- [x] Spell –∏ Buff –≤–∏–∑—É–∞–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è (—Ü–≤–µ—Ç) ‚úÖ
- [x] –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ—Ä—è–¥–∫–∞ ‚úÖ

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—á–∏—Å—Ç–∏—Ç—å —Å–ª–æ—Ç"

1. –í –ø—Ä–µ—Ñ–∞–±–µ `WandSlot` –¥–æ–±–∞–≤—å—Ç–µ **Button** (–∫—Ä–µ—Å—Ç–∏–∫)
2. –í `WandSlotUI.cs` –¥–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥:
```csharp
public void OnRemoveButtonClicked()
{
    if (editor != null)
        editor.RemoveSlot(slotIndex);
}
```

3. –í `WandEditorUI.cs`:
```csharp
public void RemoveSlot(int index)
{
    if (wand != null)
    {
        wand.RemoveSlot(index);
        RefreshUI();
    }
}
```

### –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–í `WandSlotUI.cs` –¥–æ–±–∞–≤—å—Ç–µ TextMeshProUGUI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Ä–æ–Ω–∞/–º–∞–Ω—ã.

---

**–≠—Ç–∞–ø 9 –∑–∞–≤–µ—Ä—à—ë–Ω!** –¢–µ–ø–µ—Ä—å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ—Å–æ—Ö–∞ —Å drag & drop. üéâ
