# ✅ ЭТАП 3: ЗАВЕРШЕН - Базовая система снарядов и стрельбы

## 📦 Созданные файлы

### 1. Projectile.cs
Базовый снаряд с функционалом:
- ✅ Движение в заданном направлении
- ✅ Урон при попадании (через IDamageable)
- ✅ Время жизни (дальность)
- ✅ Пробитие (Pierce)
- ✅ Возврат в пул после уничтожения
- ✅ Поддержка эффектов (spawn/hit/destroy)
- ✅ Инициализация через CastContext

### 2. ProjectilePool.cs
Пул для снарядов:
- ✅ Object Pooling для оптимизации
- ✅ Автоматическое переиспользование
- ✅ Singleton доступ
- ✅ Debug статистика

### 3. SimpleShooter.cs
Временный компонент стрельбы:
- ✅ Стрельба по ЛКМ
- ✅ Cooldown система
- ✅ Трата маны при выстреле
- ✅ Реализует ICaster
- ✅ Создаёт снаряды через пул
- ✅ Debug информация

---

## 2. Создание префаба снаряда

**ВАЖНО для видимости снаряда:**
- Спрайт должен быть **ярко-жёлтый**
- **Order in Layer: 10** (выше всех остальных объектов)
- Rigidbody **Simulated: ВЫКЛЮЧЕНО** (убери галочку)
- Collider **Is Trigger: ВКЛЮЧЕНО** (поставь галочку)

### 1. Настройка Input System (ВАЖНО!)

**ПЕРВЫМ ДЕЛОМ** проверь настройки Input System:

1. Edit → Project Settings → Player
2. Other Settings → **Active Input Handling**
3. Выбери: **Input System Package (New)** или **Both**
4. **ПЕРЕЗАПУСТИ Unity** если что-то менял

Без этого клики мыши не будут работать!

---

1. **Hierarchy → Правый клик → Create Empty**
2. Переименуйте в **Projectile_Basic**
3. **Add Component → Sprite Renderer**
   - Sprite: выберите простой круг (или создайте белый квадрат)
   - Color: **жёлтый** или **белый**
   - Sorting Layer: Default, Order in Layer: 1
4. **Add Component → Circle Collider 2D**
   - Is Trigger: **✓** (включено)
   - Radius: 0.1
5. **Add Component → Rigidbody2D**
   - Body Type: **Kinematic** (снаряд управляется скриптом)
   - Gravity Scale: 0
   - Constraints: Freeze Rotation Z: ✓
6. **Add Component → Projectile** (Scripts/Combat/Projectiles)
   - Sprite Renderer: перетащите свой Sprite Renderer
   - Spawn/Hit/Destroy Effects: оставьте пустыми (пока)

7. **Перетащите Projectile_Basic** из Hierarchy в папку **Prefabs/**
8. Удалите Projectile_Basic из Hierarchy (теперь это префаб)

### Шаг 2: Создать точку выхода снаряда (Muzzle)

1. Выберите **Player** в Hierarchy
2. **Правый клик на Player → Create Empty**
3. Переименуйте в **Muzzle**
4. Установите **Position**:
   - X: 0.5 (немного впереди игрока)
   - Y: 0
   - Z: 0

### Шаг 3: Добавить SimpleShooter на Player

1. Выберите **Player**
2. **Add Component → Simple Shooter**
3. Настройте параметры:
   - **Base Damage**: 10
   - **Mana Cost**: 5
   - **Cooldown**: 0.3
   - **Projectile Speed**: 12
   - **Range**: 10
   - **Muzzle**: перетащите **Muzzle** (дочерний объект Player)
   - **Projectile Prefab**: перетащите **Projectile_Basic** из Prefabs

### Шаг 4: Проверка компонентов на Player

Player должен иметь:
```
- Sprite Renderer
- Rigidbody2D
- Circle Collider 2D
- Player Controller
- Player Input Handler
- Mana Component
- Simple Shooter ⭐ NEW!
└── Muzzle (child) ⭐ NEW!
```

---

## 🧪 Тестирование

### Базовая проверка:

1. **Запустите игру**

2. **Проверьте ману:**
   - В левом углу должна быть полоска маны (если создали на Этапе 2)
   - Или откройте Inspector → Player → Mana Component (видно Current Mana)

3. **Стрельба:**
   - **Кликните ЛКМ** → должен появиться **жёлтый снаряд**
   - Снаряд летит в направлении **курсора мыши**
   - Мана **уменьшается на 5**
   - Снаряд **исчезает** через время (дальность)

4. **Проверьте кулдаун:**
   - Быстро кликайте ЛКМ несколько раз
   - Выстрелы должны быть **с задержкой 0.3 секунды**
   - В левом верхнем углу видна Debug информация: **"Cooldown: Ready"** или время

5. **Проверьте ману:**
   - Стреляйте до полного **опустошения маны**
   - Когда мана = 0, выстрелы **прекращаются**
   - В Console: **"Недостаточно маны!"**
   - Мана **регенерирует** через 0.5 сек

6. **Проверьте пул:**
   - В левом верхнем углу Debug информация: **"Projectile Pool: X available / Y total"**
   - При стрельбе available уменьшается
   - Когда снаряды исчезают - available увеличивается
   - Переиспользование работает! ✅

### Продвинутое тестирование:

**Тест 1: Направление снаряда**
```
1. Двигайте мышью вокруг игрока
2. Стреляйте
3. Снаряды летят точно к курсору? ✅
```

**Тест 2: Пул работает**
```
1. Стреляйте быстро (пока хватает маны)
2. Смотрите на "Projectile Pool" счётчик
3. Available должен уменьшаться/увеличиваться
4. Total не должен расти бесконечно (переиспользование)
```

**Тест 3: Регенерация маны**
```
1. Потратьте всю ману
2. Подождите 0.5 сек
3. Мана начинает регенерировать
4. При регенерации можно стрелять снова
```

**Тест 4: Движение + стрельба**
```
1. Двигайтесь WASD
2. Одновременно стреляйте ЛКМ
3. Игрок двигается И стреляет одновременно ✅
```

---

## ✅ Критерии успешного прохождения этапа:

- [x] Префаб Projectile_Basic создан
- [x] SimpleShooter добавлен на Player
- [x] Клик ЛКМ создаёт снаряд
- [x] Снаряд летит к курсору
- [x] Мана тратится при выстреле
- [x] Кулдаун работает
- [x] Pooling работает (снаряды переиспользуются)
- [x] При нехватке маны стрельба невозможна
- [x] Debug информация отображается

---

## 🎨 Визуальная настройка (опционально)

### Сделать снаряд красивее:

1. Вместо круга используйте спрайт (например, маленькую звёздочку)
2. Добавьте **Trail Renderer**:
   - Width: 0.1
   - Time: 0.2
   - Color: градиент от белого к прозрачному
3. Измените цвет в зависимости от элемента

### Изменить параметры снаряда:

- **Быстрые снаряды**: Speed = 20, Cooldown = 0.2
- **Мощные снаряды**: Damage = 30, Mana Cost = 15, Cooldown = 0.5
- **Дальнобойные**: Range = 20

---

## 🐛 Возможные проблемы и решения

### Проблема: "Снаряд не появляется"
**Решение:**
1. Projectile Prefab назначен в SimpleShooter?
2. Muzzle создан и назначен?
3. Проверьте Console на ошибки

### Проблема: "Снаряд не летит"
**Решение:**
1. Projectile → Rigidbody2D → Body Type = Kinematic
2. Projectile → Sprite Renderer видим?
3. Projectile Speed > 0?

### Проблема: "Снаряд летит не туда"
**Решение:**
1. PlayerController правильно вычисляет AimDirection?
2. Muzzle в правильной позиции?

### Проблема: "Снаряды не исчезают"
**Решение:**
1. Range > 0?
2. Projectile Speed > 0?
3. Lifetime вычисляется: Range / Speed

### Проблема: "Мана не тратится"
**Решение:**
1. ManaComponent добавлен на Player?
2. Mana Cost > 0 в SimpleShooter?

---

## 📝 Следующий этап: Этап 4 - Враги и спавнер

После успешного тестирования стрельбы скажите:
**"Приступаем к Этапу 4"**

Мы добавим:
- Врагов (EnemyController)
- Простое движение к игроку
- EnemySpawner (спавн волнами)
- EnemyPool (пулинг врагов)

---

## 📸 Как должно выглядеть:

```
Hierarchy:
├── Main Camera
├── Player
│   ├── Sprite Renderer
│   ├── Rigidbody2D
│   ├── Circle Collider 2D
│   ├── Player Controller
│   ├── Player Input Handler
│   ├── Mana Component
│   ├── Simple Shooter ⭐ NEW!
│   └── Muzzle ⭐ NEW!
├── HUD Canvas (если создали)
└── ProjectilePool (создаётся автоматически) ⭐ NEW!
```

**Визуально:** 
- Игрок (зелёный круг) движется WASD
- Клик ЛКМ создаёт жёлтый снаряд
- Снаряд летит к курсору и исчезает
- Мана тратится и регенерирует
- Debug счётчики в углу

🔫 **Готово к тестированию!**
