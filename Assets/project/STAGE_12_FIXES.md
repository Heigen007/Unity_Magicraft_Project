# Stage 12: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π –∏ —É—Ä–æ–Ω–∞

## üêõ –ò—Å–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ò–≥—Ä–æ–∫ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∑–∞ –º—ã—à—å—é** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞—Ç–∏—á–µ–Ω
2. **–ê–Ω–∏–º–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è** - –≤—Å–µ–≥–¥–∞ Idle
3. **–ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è AoE** - –Ω–µ –≤–∏–¥–Ω–æ –∑–æ–Ω—É —É—Ä–æ–Ω–∞

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –°—Ç–∞—Ç–∏—á–Ω—ã–π –∏–≥—Ä–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞
PlayerController –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –∏–≥—Ä–æ–∫–∞ –∫ –º—ã—à–∏, –Ω–æ —Å–ø—Ä–∞–π—Ç –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞—Ç–∏—á–µ–Ω.

### –†–µ—à–µ–Ω–∏–µ
–†–∞–∑–¥–µ–ª–∏—Ç—å **–≤–∏–∑—É–∞–ª –∏–≥—Ä–æ–∫–∞** –∏ **–ø–æ—Å–æ—Ö**:
- –ò–≥—Ä–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—á–Ω—ã–º
- –¢–æ–ª—å–∫–æ –ø–æ—Å–æ—Ö –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∫ –º—ã—à–∏

### –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤ PlayerController.cs:

```csharp
[Header("Rotation")]
[Tooltip("–ü–æ–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –ª–∏ –ü–û–°–û–• –∫ –∫—É—Ä—Å–æ—Ä—É –º—ã—à–∏ (–Ω–µ –∏–≥—Ä–æ–∫–∞!)")]
[SerializeField] private bool rotateWandTowardsMouse = true;

[Header("Wand Visual")]
[Tooltip("–í–∏–∑—É–∞–ª –ø–æ—Å–æ—Ö–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è")]
[SerializeField] private Transform wandVisual;

// –í UpdateRotation() —Ç–µ–ø–µ—Ä—å –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–æ—Ö
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞
Animator –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å Idle –Ω–∞ Walk.

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∫–æ–¥ –≤ `UpdateAnimation()`:

```csharp
private void UpdateAnimation()
{
    if (animator != null)
    {
        bool isMoving = IsMoving;
        animator.SetBool(IsMovingHash, isMoving);
        
        // Debug
        if (isMoving != animator.GetBool(IsMovingHash))
        {
            Debug.Log($"[Player] Animation state changed: IsMoving = {isMoving}");
        }
    }
}
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Unity:
1. **Animator Controller** –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
2. **Transitions** –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
3. **Parameter** `IsMoving` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω—ã —É—Ä–æ–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞
–£ AoE –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π –Ω–µ –≤–∏–¥–Ω–æ –∑–æ–Ω—É –ø–æ—Ä–∞–∂–µ–Ω–∏—è.

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ `SpellEffect.cs`:

```csharp
[Header("Debug")]
[Tooltip("–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–æ–Ω—É —É—Ä–æ–Ω–∞ –≤ Scene View")]
[SerializeField] private bool showDamageRadius = true;

private void OnDrawGizmosSelected()
{
    if (showDamageRadius)
    {
        Gizmos.color = Color.red;
        Gizmos.DrawWireCircle(transform.position, damageRadius);
    }
}
```

---

## üéØ –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–∫–∞

1. **Hierarchy** ‚Üí –≤—ã–±—Ä–∞—Ç—å **Player**

2. **Inspector** ‚Üí **Player Controller**:
   - **Rotate Towards Mouse**: —Å–Ω—è—Ç—å –≥–∞–ª–æ—á–∫—É ‚úó
   - **Rotate Wand Towards Mouse**: –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≥–∞–ª–æ—á–∫—É ‚úì

3. **–°–æ–∑–¥–∞—Ç—å –≤–∏–∑—É–∞–ª –ø–æ—Å–æ—Ö–∞**:
   - –ü–ö–ú –Ω–∞ **Player** ‚Üí **2D Object** ‚Üí **Sprite**
   - –ù–∞–∑–≤–∞—Ç—å `WandVisual`
   - **Transform**:
     - Position: `(0.3, 0, 0)`
     - Rotation: `(0, 0, 0)`
     - Scale: `(0.5, 0.5, 1)`

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ø—Ä–∞–π—Ç –ø–æ—Å–æ—Ö–∞**:
   - **Sprite Renderer** ‚Üí **Sprite**: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –∏–∫–æ–Ω–∫—É –ø–æ—Å–æ—Ö–∞
   - **Sorting Layer**: `Default`
   - **Order in Layer**: `10` (–≤—ã—à–µ –∏–≥—Ä–æ–∫–∞)

5. **Player Controller** ‚Üí **Wand Visual**: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å `WandVisual`

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –∏–≥—Ä–æ–∫–∞

1. **Hierarchy** ‚Üí –≤—ã–±—Ä–∞—Ç—å **Player**

2. **Window** ‚Üí **Animation** ‚Üí **Animator**

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Animator Controller**:
   - –ï—Å—Ç—å –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è `Idle` –∏ `Walk`?
   - –ï—Å—Ç—å –ª–∏ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –Ω–∏–º–∏?
   - –ï—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `IsMoving` (Bool)?

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å transitions**:
   - **Idle ‚Üí Walk**: Condition `IsMoving = true`
   - **Walk ‚Üí Idle**: Condition `IsMoving = false`
   - **Has Exit Time**: false –¥–ª—è –æ–±–æ–∏—Ö
   - **Transition Duration**: 0 –¥–ª—è –æ–±–æ–∏—Ö

5. **Play Mode** ‚Üí –¥–≤–∏–≥–∞—Ç—å—Å—è WASD ‚Üí —Å–º–æ—Ç—Ä–µ—Ç—å Console –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

---

### –®–∞–≥ 3: –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–æ–Ω—É —É—Ä–æ–Ω–∞ AoE

1. **Hierarchy** ‚Üí –Ω–∞–π—Ç–∏ –ø—Ä–µ—Ñ–∞–± –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è (Grenade/AtomicBomb/WaterSplash)

2. **Inspector** ‚Üí **Spell Effect**:
   - **Show Damage Radius**: –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≥–∞–ª–æ—á–∫—É ‚úì

3. **Play Mode** ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å AoE –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ

4. **Scene View** ‚Üí –≤—ã–±—Ä–∞—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ ‚Üí —É–≤–∏–¥–µ—Ç—å –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–≥

---

### –®–∞–≥ 4: –¢–µ—Å—Ç —É—Ä–æ–Ω–∞ AoE

1. **Play Mode**

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä–∞–≥–æ–≤** (EnemySpawner)

3. **–í—ã–±—Ä–∞—Ç—å AoE –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ** –≤ –ø–æ—Å–æ—Ö–µ

4. **–ö–∞—Å—Ç–æ–≤–∞—Ç—å —Ä—è–¥–æ–º —Å –≤—Ä–∞–≥–æ–º**

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Console**:
   ```
   [SpellEffect] Dealt damage to Enemy: 25
   [HealthComponent] Enemy took 25 damage
   ```

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** —á—Ç–æ –≤—Ä–∞–≥ –ø–æ–ª—É—á–∏–ª —É—Ä–æ–Ω (HP —É–º–µ–Ω—å—à–∏–ª–æ—Å—å)

---

## üß™ –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è:

1. **Console** ‚Üí –∏—Å–∫–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è `[Player] Animation state changed`
2. **Animator window** ‚Üí —Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è
3. **Inspector** ‚Üí **Animator** ‚Üí **Parameters** ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `IsMoving`

### –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤—Å—ë –µ—â—ë –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è:

1. **Player Controller** ‚Üí **Rotate Towards Mouse** = false
2. **Player Controller** ‚Üí **Rotation Speed** = 0

### –ï—Å–ª–∏ –ø–æ—Å–æ—Ö –Ω–µ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è:

1. **Player Controller** ‚Üí **Wand Visual** –Ω–∞–∑–Ω–∞—á–µ–Ω?
2. **Player Controller** ‚Üí **Rotate Wand Towards Mouse** = true

### –ï—Å–ª–∏ AoE –Ω–µ –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω:

1. **Spell Effect** ‚Üí **Damage Collider** –Ω–∞–∑–Ω–∞—á–µ–Ω?
2. **Circle Collider 2D** ‚Üí **Is Trigger** = true
3. **–í—Ä–∞–≥–∏** –∏–º–µ—é—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç **HealthComponent**?

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –≤–Ω–µ—Å–µ–Ω—ã –≤ —Ñ–∞–π–ª—ã:
- ‚úÖ **PlayerController.cs** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–≤–æ—Ä–æ—Ç
- ‚úÖ **SpellEffect.cs** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω—ã —É—Ä–æ–Ω–∞

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- üßô **–ò–≥—Ä–æ–∫** —Å—Ç–∞—Ç–∏—á–µ–Ω, –Ω–µ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è (rotateTowardsMouse = false)
- ü™Ñ **–ü–æ—Å–æ—Ö** –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∫ –º—ã—à–∏ (rotateWandTowardsMouse = true)
- üö∂ **–ê–Ω–∏–º–∞—Ü–∏—è** –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è Idle ‚Üî Walk (—Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
- üí• **AoE –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è** –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∑–æ–Ω—É —É—Ä–æ–Ω–∞ (–∫—Ä–∞—Å–Ω—ã–µ –∫—Ä—É–≥–∏ –≤ Scene View)
- ‚öîÔ∏è **–£—Ä–æ–Ω** –Ω–∞–Ω–æ—Å–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ Console)
- üì¶ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Box Collider 2D** –∏ Circle Collider 2D –¥–ª—è –∑–æ–Ω—ã —É—Ä–æ–Ω–∞

## üîß –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω:

- ‚úÖ **PlayerController.cs** - —Ä–∞–∑–¥–µ–ª—ë–Ω –ø–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–∫–∞/–ø–æ—Å–æ—Ö–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
- ‚úÖ **SpellEffect.cs** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω—ã —É—Ä–æ–Ω–∞, –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Box Collider

---

**–î–∞—Ç–∞**: –ù–æ—è–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø